modeling_options: &modeling_options
  windIO_plant: !include windio.yaml
  heterogeneous_map: !include wind_map.yaml
  layout:
    type: gridfarm
    N_turbines: 7
    N_substations: 1
  aero:
    return_turbine_output: True
  floris:
    peak_shaving_fraction: 0.2
    peak_shaving_TI_threshold: 0.0
  collection:
    max_turbines_per_string: 8
    solver_name: highs
    solver_options:
      time_limit: 60
      mip_gap: 0.02
      seed: 42
    model_options:
      topology: radial  # radial, branched
      feeder_route: segmented
      feeder_limit: unlimited
  offshore: false
  floating: false
  costs:
    # generated from WISDEM (v3.13.x)
    # https://github.com/NREL/openfast-turbine-models/blob/main/IEA-scaled/NREL-2.8-127/20_monolithic_opt2/NREL-2.8-127.yaml
    # converted with https://github.com/IEAWindSystems/windIO/tree/main/windIO/converters
    rated_power: 2820000.0  # W
    num_blades: 3
    rated_thrust_N: 394071.5511477288
    gust_velocity_m_per_s: 52.5
    blade_surface_area: 59.707910759797734
    tower_mass: 178.86839386450217
    nacelle_mass: 83.28780050671293
    hub_mass: 7.728056554744464
    blade_mass: 13.986721230923094
    foundation_height: 0.0
    commissioning_cost_kW: 44.0
    decommissioning_cost_kW: 58.0
    trench_len_to_substation_km: 50.0
    distance_to_interconnect_mi: 4.97096954
    interconnect_voltage_kV: 130.0
    tcc_per_kW: 706.411091392774  # (USD/kW)
    opex_per_kW: 44.00  # (USD/kWh)

system:
  type: group
  systems:
    aepFLORIS:
      type: component
      module: ard.farm_aero.floris
      object: FLORISAEP
      promotes: ["x_turbines", "y_turbines", "AEP_farm"]
      kwargs:
        modeling_options: *modeling_options
        data_path:
        case_title: "default"
    boundary:
      type: component
      module: ard.layout.boundary
      object: FarmBoundaryDistancePolygon
      promotes: ["*"]
      kwargs:
        modeling_options: *modeling_options
    exclusions:
      type: component
      module: ard.layout.exclusions
      object: FarmExclusionDistancePolygon
      promotes: ["*"]
      kwargs:
        modeling_options: *modeling_options
    collection:
      type: component
      module: ard.collection.optiwindnet_wrap
      object: OptiwindnetCollection
      promotes: ["*"]
      kwargs:
        modeling_options: *modeling_options
    spacing_constraint:
      type: component
      module: ard.layout.spacing
      object: TurbineSpacing
      promotes: ["*"]
      kwargs:
        modeling_options: *modeling_options
    tcc:
      type: component
      module: ard.cost.wisdem_wrap
      object: TurbineCapitalCosts
      promotes: [
        "turbine_number",
        "machine_rating",
        "tcc_per_kW",
        "offset_tcc_per_kW",
      ]
    landbosse:
      type: component
      module: ard.cost.wisdem_wrap
      object: LandBOSSEWithSpacingApproximations
      promotes: [
        "total_length_cables",
      ]
      kwargs:
        modeling_options: *modeling_options
    opex:
      type: component
      module: ard.cost.wisdem_wrap
      object: OperatingExpenses
      promotes: [
        "turbine_number",
        "machine_rating",
        "opex_per_kW"
      ]
    financese:
      type: component
      module: ard.cost.wisdem_wrap
      object: FinanceSEGroup
      promotes: [
        "turbine_number",
        "machine_rating",
        "tcc_per_kW",
        "offset_tcc_per_kW",
        "opex_per_kW",
      ]
      kwargs:
        modeling_options: *modeling_options
  connections:
    - ["AEP_farm", "financese.plant_aep_in"]
    - ["landbosse.total_capex_kW", "financese.bos_per_kW"]

analysis_options:
  driver:
    name: ScipyOptimizeDriver
    options:
      optimizer: COBYLA
      opt_settings:
        rhobeg: 1.0  # initial exploration scale
        #maxiter: 250
        maxiter: 50
      debug_print:
        - desvars
        - objs
  design_variables:
    x_turbines:
      units: km
      lower: -0.100
      upper:  2.100
      scaler: 2.0  # rhobeg [units] / scaler = 500 m
    y_turbines:
      units: km
      lower: -0.500
      upper:  2.300
      scaler: 2.0  # rhobeg [units] / scaler = 500 m
  constraints:
    boundary_distances:
      units: km
      upper: 0.0
      scaler: 2.0
    exclusion_distances:
      units: km
      upper: 0.0
      scaler: 2.0
    spacing_constraint.turbine_spacing:
      units: km
      lower: 0.5 # ~ 4D
  objectives:
    financese.lcoe:
      scaler: 1.0
  recorder:
    filepath: cases.sql
